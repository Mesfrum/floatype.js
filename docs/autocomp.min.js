const DEFAULTS={onQuery:null,onNavigate:null,onSelect:null,onRender:null,debounce:100};export function autocomp(e,t={}){const n={...DEFAULTS,...t};let o,l,c,u=0,a=[];function i(e){if("keydown"!==e.type||!function(e){if(!o)return!0;switch(e.keyCode){case 38:return d(-1,e);case 40:return d(1,e);case 13:return s(u),void f();case 27:return void f()}}(e)){if("blur"!==e.type)return""===e.target.value?(f(),void(l=null)):void(e.target.value!==l&&(l=e.target.value,clearTimeout(c),c=setTimeout(r,n.debounce)));setTimeout(f,100)}}async function r(){l&&(a=await n.onQuery(l),a.length?(o||(o=document.createElement("div"),Object.assign(o.style,{width:window.getComputedStyle(e).width,position:"absolute",left:`${e.offsetLeft}px`}),o.classList.add("autocomp"),e.parentNode.insertBefore(o,e.nextSibling)),o.innerHTML="",a.forEach(((e,t)=>{const l=document.createElement("div");l.classList.add("autocomp-item"),n.onRender?l.appendChild(n.onRender(e)):l.innerText=e,t===u&&l.classList.add("autocomp-sel"),l.addEventListener("click",(()=>s(t))),o.appendChild(l)}))):f())}function d(e,t){t.preventDefault();const n=o.querySelector(`:nth-child(${u+1})`);n&&n.classList.remove("autocomp-sel"),u=(u+e+a.length)%a.length,o.querySelector(`:nth-child(${u+1})`).classList.add("autocomp-sel")}function s(t){n.onSelect&&(l=n.onSelect(a[t]),e.value=l||a[t])}function f(){a=[],u=0,o&&(o.remove(),o=null)}e.autocomplete="off",["keyup","keydown","blur","focus"].forEach((t=>e.addEventListener(t,i)))}export default autocomp;
