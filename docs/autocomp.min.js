export function autocomp(e,t={}){const n={onQuery:null,onNavigate:null,onSelect:null,onRender:null,debounce:100,...t};let o,l,u,a=0,i=[];function c(e){if("keydown"!==e.type||!function(e){if(!o){if(40===e.keyCode)return;return!0}switch(e.keyCode){case 38:return d(-1,e);case 40:return d(1,e);case 13:return s(a),void f();case 27:return void f()}}(e)){if("blur"!==e.type)return""===e.target.value?(f(),void(l=null)):void(e.target.value===l&&40!==e.keyCode||(l=e.target.value,clearTimeout(u),u=setTimeout(r,n.debounce)));f()}}async function r(){l&&(i=await n.onQuery(l),i.length?(o||(o=document.createElement("div"),Object.assign(o.style,{width:window.getComputedStyle(e).width,position:"absolute",left:`${e.offsetLeft}px`,top:`${e.offsetTop+e.offsetHeight}px`}),o.classList.add("autocomp"),e.parentNode.insertBefore(o,e.nextSibling)),o.innerHTML="",i.forEach(((e,t)=>{const l=document.createElement("div");l.classList.add("autocomp-item"),n.onRender?l.appendChild(n.onRender(e)):l.innerText=e,t===a&&l.classList.add("autocomp-sel"),l.addEventListener("mousedown",(()=>s(t))),o.appendChild(l)}))):f())}function d(e,t){t.preventDefault();const n=o.querySelector(`:nth-child(${a+1})`);n&&n.classList.remove("autocomp-sel"),a=(a+e+i.length)%i.length,o.querySelector(`:nth-child(${a+1})`).classList.add("autocomp-sel")}function s(t){n.onSelect&&(l=n.onSelect(i[t]),e.value=l||i[t])}function f(){i=[],a=0,o&&(o.remove(),o=null)}e.autocomplete="off",["input","keydown","blur"].forEach((t=>e.addEventListener(t,c)))}export default autocomp;
